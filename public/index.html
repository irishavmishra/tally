<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tally Automation - Advanced Accounting Entry System</title>
  <meta name="description"
    content="Automate your Tally accounting entries with our advanced API-powered system. Create vouchers, manage ledgers, and streamline your accounting workflow.">
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>ğŸš€ Tally Automation</h1>
      <p>Advanced Accounting Entry System - Powered by Tally API</p>
    </header>

    <!-- Connection Status -->
    <div class="connection-status">
      <div class="status-indicator">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Checking connection...</span>
      </div>
      <button class="btn btn-secondary" onclick="testConnection()">
        <span>ğŸ”„</span>
        <span>Test Connection</span>
      </button>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <!-- Main Navigation Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('voucher')">ğŸ“ Create Voucher</button>
      <button class="tab" onclick="switchTab('ledger')">ğŸ“Š Create Ledger</button>
      <button class="tab" onclick="switchTab('transfer')">ğŸ”„ Ledger Transfer</button>
      <button class="tab" onclick="switchTab('bank')">ğŸ¦ Bank Statement</button>
      <button class="tab" onclick="switchTab('bulk')">ğŸ“¦ Bulk Import</button>
      <button class="tab" onclick="switchTab('view')">ğŸ‘ï¸ View Data</button>
    </div>

    <!-- Tab Content: Create Voucher -->
    <div id="voucherTab" class="tab-content active">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">ğŸ“</div>
          <h2 class="card-title">Create Accounting Voucher</h2>
        </div>

        <form id="voucherForm" onsubmit="createVoucher(event)">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Company Name</label>
              <input type="text" class="form-input" id="voucherCompany" placeholder="Enter company name" required>
            </div>

            <div class="form-group">
              <label class="form-label">Voucher Type</label>
              <select class="form-select" id="voucherType" required>
                <option value="">Select Type</option>
                <option value="Journal">Journal</option>
                <option value="Payment">Payment</option>
                <option value="Receipt">Receipt</option>
                <option value="Sales">Sales</option>
                <option value="Purchase">Purchase</option>
                <option value="Contra">Contra</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Date (YYYYMMDD)</label>
              <input type="text" class="form-input" id="voucherDate" placeholder="20260115" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Voucher Number (Optional)</label>
            <input type="text" class="form-input" id="voucherNumber" placeholder="Auto-generated if left empty">
          </div>

          <div class="form-group">
            <label class="form-label">Narration</label>
            <textarea class="form-textarea" id="voucherNarration"
              placeholder="Enter transaction description"></textarea>
          </div>

          <div class="ledger-entries">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <h3 style="color: var(--primary);">Ledger Entries</h3>
              <button type="button" class="btn btn-secondary" onclick="addLedgerEntry()">
                <span>â•</span>
                <span>Add Entry</span>
              </button>
            </div>
            <div id="ledgerEntriesContainer">
              <!-- Ledger entries will be added here -->
            </div>
          </div>

          <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;">
            <span>âœ¨</span>
            <span>Create Voucher in Tally</span>
          </button>
        </form>
      </div>
    </div>

    <!-- Tab Content: Create Ledger -->
    <div id="ledgerTab" class="tab-content">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">ğŸ“Š</div>
          <h2 class="card-title">Create New Ledger</h2>
        </div>

        <form id="ledgerForm" onsubmit="createLedger(event)">
          <div class="form-group">
            <label class="form-label">Company Name</label>
            <input type="text" class="form-input" id="ledgerCompany" placeholder="Enter company name" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Ledger Name</label>
              <input type="text" class="form-input" id="ledgerName" placeholder="e.g., HDFC Bank" required>
            </div>

            <div class="form-group">
              <label class="form-label">Parent Group</label>
              <select class="form-select" id="ledgerParent" required>
                <option value="">Select Parent</option>
                <option value="Bank Accounts">Bank Accounts</option>
                <option value="Cash-in-Hand">Cash-in-Hand</option>
                <option value="Sundry Debtors">Sundry Debtors</option>
                <option value="Sundry Creditors">Sundry Creditors</option>
                <option value="Sales Accounts">Sales Accounts</option>
                <option value="Purchase Accounts">Purchase Accounts</option>
                <option value="Direct Expenses">Direct Expenses</option>
                <option value="Indirect Expenses">Indirect Expenses</option>
                <option value="Direct Incomes">Direct Incomes</option>
                <option value="Indirect Incomes">Indirect Incomes</option>
                <option value="Loans & Advances (Asset)">Loans & Advances (Asset)</option>
                <option value="Secured Loans">Secured Loans</option>
                <option value="Unsecured Loans">Unsecured Loans</option>
                <option value="Capital Account">Capital Account</option>
                <option value="Reserves & Surplus">Reserves & Surplus</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Opening Balance</label>
              <input type="number" class="form-input" id="ledgerBalance" placeholder="0.00" step="0.01" value="0">
            </div>
          </div>

          <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;">
            <span>âœ¨</span>
            <span>Create Ledger in Tally</span>
          </button>
        </form>
      </div>
    </div>

    <!-- Tab Content: Ledger Transfer -->
    <div id="transferTab" class="tab-content">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">ğŸ”„</div>
          <h2 class="card-title">Transfer Entries Between Ledgers</h2>
        </div>

        <div class="alert alert-info" style="margin-bottom: 1.5rem;">
          <span>â„¹ï¸</span>
          <span>Transfer amounts from one ledger to another by creating journal entries. Useful for reclassifying
            transactions or correcting ledger assignments.</span>
        </div>

        <!-- Single Transfer -->
        <h3 style="color: var(--primary); margin-bottom: 1rem;">Single Transfer</h3>
        <form id="singleTransferForm" onsubmit="createSingleTransfer(event)">
          <div class="form-group">
            <label class="form-label">Company Name</label>
            <input type="text" class="form-input" id="transferCompany" placeholder="Enter company name" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">From Ledger</label>
              <input type="text" class="form-input" id="fromLedger" placeholder="e.g., Miscellaneous Expenses" required>
            </div>

            <div class="form-group">
              <label class="form-label">To Ledger</label>
              <input type="text" class="form-input" id="toLedger" placeholder="e.g., Rent" required>
            </div>

            <div class="form-group">
              <label class="form-label">Amount</label>
              <input type="number" class="form-input" id="transferAmount" placeholder="0.00" step="0.01" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Date (YYYYMMDD)</label>
              <input type="text" class="form-input" id="transferDate" placeholder="20260115" required>
            </div>

            <div class="form-group">
              <label class="form-label">Narration</label>
              <input type="text" class="form-input" id="transferNarration" placeholder="Transfer entry">
            </div>
          </div>

          <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
            <span>ğŸ”„</span>
            <span>Create Transfer Entry</span>
          </button>
        </form>

        <!-- Bulk Transfer -->
        <h3 style="color: var(--primary); margin: 2rem 0 1rem;">Bulk Transfer</h3>
        <div class="form-group">
          <label class="form-label">Paste JSON Data</label>
          <textarea class="form-textarea" id="bulkTransferJson"
            placeholder='[{"fromLedger":"Old Ledger","toLedger":"New Ledger","amount":1000,"date":"20260115","narration":"Transfer"}]'
            style="min-height: 200px;"></textarea>
          <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">
            Format: Array of transfer objects with fromLedger, toLedger, amount, date, and narration
          </p>
        </div>

        <button class="btn btn-primary" onclick="processBulkTransfers()" style="width: 100%;">
          <span>ğŸš€</span>
          <span>Process Bulk Transfers</span>
        </button>

        <div id="transferResults" style="margin-top: 1.5rem;"></div>
      </div>

      <!-- Info Card -->
      <div class="card" style="margin-top: 1.5rem;">
        <div class="card-header">
          <div class="card-icon">ğŸ’¡</div>
          <h2 class="card-title">How It Works</h2>
        </div>

        <div style="color: var(--text-secondary); line-height: 1.8;">
          <h3 style="color: var(--primary); margin-bottom: 0.5rem;">What is Ledger Transfer?</h3>
          <p style="margin-bottom: 1rem;">Ledger transfer creates journal entries to move amounts from one ledger to
            another. This is useful when you need to reclassify expenses, correct ledger assignments, or reorganize your
            chart of accounts.</p>

          <h3 style="color: var(--primary); margin-bottom: 0.5rem;">Example Use Cases:</h3>
          <ul style="margin-bottom: 1rem; padding-left: 1.5rem;">
            <li>Move expenses from "Miscellaneous" to specific categories</li>
            <li>Reclassify transactions after bank reconciliation</li>
            <li>Correct ledger assignments from bulk imports</li>
            <li>Reorganize chart of accounts</li>
          </ul>

          <h3 style="color: var(--primary); margin-bottom: 0.5rem;">Journal Entry Created:</h3>
          <div
            style="background: var(--bg-tertiary); padding: 1rem; border-radius: var(--radius-sm); font-family: monospace; font-size: 0.875rem;">
            <div>Voucher Type: Journal</div>
            <div>Dr: To Ledger - â‚¹Amount</div>
            <div>Cr: From Ledger - â‚¹Amount</div>
          </div>

          <div
            style="background: rgba(245, 158, 11, 0.1); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem;">
            <strong style="color: var(--warning);">âš ï¸ Important:</strong>
            <p style="margin-top: 0.5rem;">This creates new journal entries. It does not modify existing vouchers. Make
              sure both ledgers exist in Tally before transferring.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Bank Statement Import -->
    <div id="bankTab" class="tab-content">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">ğŸ¦</div>
          <h2 class="card-title">Import Bank Statement</h2>
        </div>

        <div class="alert alert-info" style="margin-bottom: 1.5rem;">
          <span>â„¹ï¸</span>
          <span>Upload your bank statement in CSV, Excel, or JSON format. The system will automatically parse and create
            vouchers in Tally.</span>
        </div>

        <form id="bankStatementForm">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Company Name</label>
              <input type="text" class="form-input" id="bankCompany" placeholder="Enter company name" required>
            </div>

            <div class="form-group">
              <label class="form-label">Bank Type</label>
              <select class="form-select" id="bankType">
                <option value="generic">Generic Format</option>
                <option value="hdfc">HDFC Bank</option>
                <option value="icici">ICICI Bank</option>
                <option value="sbi">State Bank of India</option>
                <option value="axis">Axis Bank</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Bank Ledger Name</label>
              <input type="text" class="form-input" id="bankLedgerName" placeholder="e.g., HDFC Bank"
                value="Bank Account">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Default Expense Ledger</label>
              <input type="text" class="form-input" id="defaultExpenseLedger" value="Miscellaneous Expenses">
            </div>

            <div class="form-group">
              <label class="form-label">Default Income Ledger</label>
              <input type="text" class="form-input" id="defaultIncomeLedger" value="Miscellaneous Income">
            </div>

            <div class="form-group">
              <label class="form-label">Auto-Categorize</label>
              <select class="form-select" id="autoCategorie">
                <option value="true">Yes - Auto-detect categories</option>
                <option value="false">No - Use default ledgers</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Upload Bank Statement</label>
            <input type="file" class="form-input" id="bankStatementFile" accept=".csv,.xlsx,.xls,.json" required>
            <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">
              Supported formats: CSV, Excel (.xlsx, .xls), JSON | Max size: 10MB
            </p>
          </div>

          <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button type="button" class="btn btn-secondary" onclick="previewBankStatement()" style="flex: 1;">
              <span>ğŸ‘ï¸</span>
              <span>Preview Transactions</span>
            </button>
            <button type="button" class="btn btn-primary" onclick="importBankStatement()" style="flex: 1;">
              <span>ğŸš€</span>
              <span>Import to Tally</span>
            </button>
          </div>
        </form>

        <div id="bankStatementResults" style="margin-top: 1.5rem;"></div>
      </div>

      <!-- Info Card -->
      <div class="card" style="margin-top: 1.5rem;">
        <div class="card-header">
          <div class="card-icon">ğŸ’¡</div>
          <h2 class="card-title">How It Works</h2>
        </div>

        <div style="color: var(--text-secondary); line-height: 1.8;">
          <h3 style="color: var(--primary); margin-bottom: 0.5rem;">Step 1: Download Statement</h3>
          <p style="margin-bottom: 1rem;">Download your bank statement from your bank's website in CSV or Excel format.
          </p>

          <h3 style="color: var(--primary); margin-bottom: 0.5rem;">Step 2: Upload File</h3>
          <p style="margin-bottom: 1rem;">Select your bank type and upload the statement file. The system will
            automatically detect the format.</p>

          <h3 style="color: var(--primary); margin-bottom: 0.5rem;">Step 3: Preview</h3>
          <p style="margin-bottom: 1rem;">Click "Preview" to see how transactions will be categorized and converted to
            vouchers.</p>

          <h3 style="color: var(--primary); margin-bottom: 0.5rem;">Step 4: Import</h3>
          <p style="margin-bottom: 1rem;">Click "Import to Tally" to automatically create all vouchers in Tally.</p>

          <div
            style="background: rgba(0, 212, 255, 0.1); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem;">
            <strong style="color: var(--primary);">Auto-Categorization:</strong>
            <p style="margin-top: 0.5rem;">The system automatically categorizes transactions based on description
              keywords (Salary, Rent, Utilities, etc.)</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Bulk Import -->
    <div id="bulkTab" class="tab-content">
      <div class="card">
        <div class="card-header">
          <div class="card-icon">ğŸ“¦</div>
          <h2 class="card-title">Bulk Voucher Import</h2>
        </div>

        <div class="form-group">
          <label class="form-label">Upload CSV/JSON File</label>
          <input type="file" class="form-input" id="bulkFile" accept=".csv,.json">
          <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">
            Upload a CSV or JSON file with multiple voucher entries for bulk processing.
          </p>
        </div>

        <div class="form-group">
          <label class="form-label">Or Paste JSON Data</label>
          <textarea class="form-textarea" id="bulkJson"
            placeholder='[{"voucherType":"Journal","date":"20260115","companyName":"ABC Ltd","narration":"Test","ledgerEntries":[...]}]'
            style="min-height: 200px;"></textarea>
        </div>

        <button class="btn btn-primary" onclick="processBulkVouchers()" style="width: 100%;">
          <span>ğŸš€</span>
          <span>Process Bulk Vouchers</span>
        </button>

        <div id="bulkResults" style="margin-top: 1.5rem;"></div>
      </div>
    </div>

    <!-- Tab Content: View Data -->
    <div id="viewTab" class="tab-content">
      <div class="grid">
        <div class="card">
          <div class="card-header">
            <div class="card-icon">ğŸ¢</div>
            <h2 class="card-title">Companies</h2>
          </div>
          <button class="btn btn-secondary" onclick="loadCompanies()" style="width: 100%;">
            <span>ğŸ”„</span>
            <span>Load Companies</span>
          </button>
          <div id="companiesList" style="margin-top: 1rem;"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-icon">ğŸ“‹</div>
            <h2 class="card-title">Ledgers</h2>
          </div>
          <div class="form-group">
            <input type="text" class="form-input" id="viewLedgerCompany" placeholder="Enter company name">
          </div>
          <button class="btn btn-secondary" onclick="loadLedgers()" style="width: 100%;">
            <span>ğŸ”„</span>
            <span>Load Ledgers</span>
          </button>
          <div id="ledgersList" style="margin-top: 1rem;"></div>
        </div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>

</html>