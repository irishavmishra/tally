<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tally Automation</title>
  <meta name="description" content="Automate your Tally accounting entries with our advanced API-powered system.">
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>Tally Automation</h1>
      <p>Advanced Accounting Entry System</p>
    </header>

    <!-- Connection Status -->
    <div class="connection-status">
      <div class="status-indicator">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Checking connection...</span>
      </div>
      <button class="btn btn-secondary" onclick="testConnection()">
        Test Connection
      </button>
    </div>

    <!-- Alert Container -->
    <div id="alertContainer"></div>

    <!-- Global Ledger Datalist for Autocomplete -->
    <datalist id="ledgersList"></datalist>

    <!-- Main Navigation Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="switchTab('voucher')">Create Voucher</button>
      <button class="tab" onclick="switchTab('ledger')">Create Ledger</button>
      <button class="tab" onclick="switchTab('transfer')">Ledger Transfer</button>
      <button class="tab" onclick="switchTab('bank')">Bank Statement</button>
      <button class="tab" onclick="switchTab('bulk')">Bulk Import</button>
      <button class="tab" onclick="switchTab('view')">View Data</button>
    </div>

    <!-- Tab Content: Create Voucher -->
    <div id="voucherTab" class="tab-content active">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Create Voucher</h2>
        </div>

        <form id="voucherForm" onsubmit="createVoucher(event)">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Company Name</label>
              <input type="text" class="form-input" id="voucherCompany" placeholder="Enter company name" required>
            </div>

            <div class="form-group">
              <label class="form-label">Voucher Type</label>
              <select class="form-select" id="voucherType" required>
                <option value="">Select Type</option>
                <option value="Journal">Journal</option>
                <option value="Payment">Payment</option>
                <option value="Receipt">Receipt</option>
                <option value="Sales">Sales</option>
                <option value="Purchase">Purchase</option>
                <option value="Contra">Contra</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Date (YYYYMMDD)</label>
              <input type="text" class="form-input" id="voucherDate" placeholder="20260115" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Voucher Number (Optional)</label>
            <input type="text" class="form-input" id="voucherNumber" placeholder="Auto-generated if left empty">
          </div>

          <div class="form-group">
            <label class="form-label">Narration</label>
            <textarea class="form-textarea" id="voucherNarration"
              placeholder="Enter transaction description"></textarea>
          </div>

          <div class="ledger-entries">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
              <h3 style="font-size: 1.1rem; font-weight: 600;">Ledger Entries</h3>
              <button type="button" class="btn btn-secondary" onclick="addLedgerEntry()">
                Add Entry
              </button>
            </div>
            <div id="ledgerEntriesContainer">
              <!-- Ledger entries will be added here -->
            </div>
          </div>

          <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;">
            Create Voucher
          </button>
        </form>
      </div>
    </div>

    <!-- Tab Content: Create Ledger -->
    <div id="ledgerTab" class="tab-content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Create Ledger</h2>
        </div>

        <form id="ledgerForm" onsubmit="createLedger(event)">
          <div class="form-group">
            <label class="form-label">Company Name</label>
            <input type="text" class="form-input" id="ledgerCompany" placeholder="Enter company name" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Ledger Name</label>
              <input type="text" class="form-input" id="ledgerName" placeholder="e.g., HDFC Bank" required>
            </div>

            <div class="form-group">
              <label class="form-label">Parent Group</label>
              <select class="form-select" id="ledgerParent" required>
                <option value="">Select Parent</option>
                <option value="Bank Accounts">Bank Accounts</option>
                <option value="Cash-in-Hand">Cash-in-Hand</option>
                <option value="Sundry Debtors">Sundry Debtors</option>
                <option value="Sundry Creditors">Sundry Creditors</option>
                <option value="Sales Accounts">Sales Accounts</option>
                <option value="Purchase Accounts">Purchase Accounts</option>
                <option value="Direct Expenses">Direct Expenses</option>
                <option value="Indirect Expenses">Indirect Expenses</option>
                <option value="Direct Incomes">Direct Incomes</option>
                <option value="Indirect Incomes">Indirect Incomes</option>
                <option value="Loans & Advances (Asset)">Loans & Advances (Asset)</option>
                <option value="Secured Loans">Secured Loans</option>
                <option value="Unsecured Loans">Unsecured Loans</option>
                <option value="Capital Account">Capital Account</option>
                <option value="Reserves & Surplus">Reserves & Surplus</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Opening Balance</label>
              <input type="number" class="form-input" id="ledgerBalance" placeholder="0.00" step="0.01" value="0">
            </div>
          </div>

          <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1.5rem;">
            Create Ledger
          </button>
        </form>
      </div>
    </div>

    <!-- Tab Content: Ledger Transfer -->
    <div id="transferTab" class="tab-content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Ledger Transfer</h2>
        </div>

        <div class="alert alert-info">
          <span>Transfer amounts from one ledger to another by creating journal entries.</span>
        </div>

        <!-- Single Transfer -->
        <h3 style="margin-bottom: 1rem; margin-top: 1.5rem; font-size: 1.1rem;">Single Transfer</h3>
        <form id="singleTransferForm" onsubmit="createSingleTransfer(event)">
          <div class="form-group">
            <label class="form-label">Company Name</label>
            <input type="text" class="form-input" id="transferCompany" placeholder="Enter company name" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">From Ledger</label>
              <input type="text" class="form-input" id="fromLedger" placeholder="e.g., Miscellaneous Expenses"
                list="ledgersList" required>
            </div>

            <div class="form-group">
              <label class="form-label">To Ledger</label>
              <input type="text" class="form-input" id="toLedger" placeholder="e.g., Rent" list="ledgersList" required>
            </div>

            <div class="form-group">
              <label class="form-label">Amount</label>
              <input type="number" class="form-input" id="transferAmount" placeholder="0.00" step="0.01" required>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Date (YYYYMMDD)</label>
              <input type="text" class="form-input" id="transferDate" placeholder="20260115" required>
            </div>

            <div class="form-group">
              <label class="form-label">Narration</label>
              <input type="text" class="form-input" id="transferNarration" placeholder="Transfer entry">
            </div>
          </div>

          <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
            Create Transfer Entry
          </button>
        </form>

        <!-- Bulk Transfer -->
        <h3 style="margin: 2rem 0 1rem; font-size: 1.1rem;">Bulk Transfer</h3>
        <div class="form-group">
          <label class="form-label">Paste JSON Data</label>
          <textarea class="form-textarea" id="bulkTransferJson"
            placeholder='[{"fromLedger":"Old Ledger","toLedger":"New Ledger","amount":1000,"date":"20260115","narration":"Transfer"}]'></textarea>
          <p class="text-muted" style="font-size: 0.85rem; margin-top: 0.5rem;">
            Format: Array of transfer objects with fromLedger, toLedger, amount, date, and narration
          </p>
        </div>

        <button class="btn btn-secondary" onclick="processBulkTransfers()" style="width: 100%;">
          Process Bulk Transfers
        </button>

        <!-- Entry-Based Transfer Section -->
        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
          <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">Entry-Based Transfer</h3>
          <div class="alert alert-info">
            <span>Select source ledger ki entries load karo, checkbox se select karo, aur target ledger me transfer
              karo.</span>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Source Ledger</label>
              <input type="text" class="form-input" id="sourceLedger" placeholder="e.g., Miscellaneous Expenses"
                list="ledgersList">
            </div>
            <div class="form-group">
              <label class="form-label">From Date (YYYYMMDD)</label>
              <input type="text" class="form-input" id="entryFromDate" placeholder="20260101">
            </div>
            <div class="form-group">
              <label class="form-label">To Date (YYYYMMDD)</label>
              <input type="text" class="form-input" id="entryToDate" placeholder="20261231">
            </div>
          </div>

          <button class="btn btn-secondary" onclick="loadLedgerEntries()" style="width: 100%; margin-bottom: 1rem;">
            Load Entries
          </button>

          <!-- Entries Table Container -->
          <div id="entriesTableContainer" style="display: none; margin: 1rem 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" id="selectAllEntries" onchange="toggleSelectAllEntries()">
                <span>Select All</span>
              </label>
              <span id="selectedCount" style="color: var(--text-secondary); font-size: 0.9rem;">0 selected</span>
            </div>
            <div id="entriesTable"
              style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--radius-sm);">
              <!-- Entries will be loaded here -->
            </div>
          </div>

          <!-- Transfer Target -->
          <div id="transferTargetContainer" style="display: none; margin-top: 1rem;">
            <div class="form-group">
              <label class="form-label">Target Ledger (jisme transfer karna hai)</label>
              <input type="text" class="form-input" id="targetLedger" placeholder="e.g., Rent" list="ledgersList">
            </div>
            <button class="btn btn-primary" onclick="transferSelectedEntries()" style="width: 100%;">
              Transfer Selected Entries
            </button>
          </div>
        </div>

        <div id="transferResults" style="margin-top: 1.5rem;"></div>
      </div>
    </div>

    <!-- Tab Content: Bank Statement Import -->
    <div id="bankTab" class="tab-content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Import Bank Statement</h2>
        </div>

        <div class="alert alert-info">
          <span>Upload your bank statement in CSV, Excel, JSON, or PDF format.</span>
        </div>

        <form id="bankStatementForm">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Company Name</label>
              <input type="text" class="form-input" id="bankCompany" placeholder="Enter company name" required>
            </div>

            <div class="form-group">
              <label class="form-label">Bank Type</label>
              <select class="form-select" id="bankType">
                <option value="generic">Generic Format</option>
                <option value="hdfc">HDFC Bank</option>
                <option value="icici">ICICI Bank</option>
                <option value="sbi">State Bank of India</option>
                <option value="axis">Axis Bank</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Bank Ledger Name</label>
              <input type="text" class="form-input" id="bankLedgerName" placeholder="e.g., HDFC Bank"
                value="Bank Account" list="ledgersList">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Default Expense Ledger</label>
              <input type="text" class="form-input" id="defaultExpenseLedger" value="Miscellaneous Expenses"
                list="ledgersList">
            </div>

            <div class="form-group">
              <label class="form-label">Default Income Ledger</label>
              <input type="text" class="form-input" id="defaultIncomeLedger" value="Miscellaneous Income"
                list="ledgersList">
            </div>

            <div class="form-group">
              <label class="form-label">Auto-Categorize</label>
              <select class="form-select" id="autoCategorie">
                <option value="true">Yes - Auto-detect categories</option>
                <option value="false">No - Use default ledgers</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Upload Bank Statement</label>
            <input type="file" class="form-input" id="bankStatementFile" accept=".csv,.xlsx,.xls,.json,.pdf" required>
            <p class="text-muted" style="font-size: 0.85rem; margin-top: 0.5rem;">
              Supported formats: CSV, Excel (.xlsx, .xls), JSON, PDF (with OCR) | Max size: 20MB
            </p>
          </div>

          <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
            <button type="button" class="btn btn-secondary" onclick="previewBankStatement()" style="flex: 1;">
              Preview Transactions
            </button>
            <button type="button" class="btn btn-primary" onclick="importBankStatement()" style="flex: 1;">
              Import to Tally
            </button>
          </div>
        </form>

        <!-- PDF Import with OCR Section -->
        <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid var(--border-color);">
          <h3 style="margin-bottom: 1rem; font-size: 1.1rem;">PDF Import with OCR (Suspense Ledger)</h3>
          <div class="alert alert-info">
            <span>PDF bank statement upload karo - OCR se parse hoga aur saari entries <strong>Suspense A/c</strong> me
              jayengi.</span>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Suspense Ledger</label>
              <input type="text" class="form-input" id="suspenseLedger" value="Suspense A/c" list="ledgersList">
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Upload PDF Bank Statement</label>
            <input type="file" class="form-input" id="pdfBankStatementFile" accept=".pdf">
            <p class="text-muted" style="font-size: 0.85rem; margin-top: 0.5rem;">
              Only PDF files | OCR enabled for scanned documents | Max size: 20MB
            </p>
          </div>

          <div style="display: flex; gap: 1rem; margin-top: 1rem;">
            <button type="button" class="btn btn-secondary" onclick="previewPDFStatement()" style="flex: 1;">
              Preview PDF
            </button>
            <button type="button" class="btn btn-primary" onclick="importPDFStatement()" style="flex: 1;">
              Import PDF to Tally
            </button>
          </div>
        </div>

        <div id="bankStatementResults" style="margin-top: 1.5rem;"></div>
      </div>
    </div>

    <!-- Tab Content: Bulk Import -->
    <div id="bulkTab" class="tab-content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Bulk Import</h2>
        </div>

        <div class="form-group">
          <label class="form-label">Upload CSV/JSON File</label>
          <input type="file" class="form-input" id="bulkFile" accept=".csv,.json">
        </div>

        <div class="form-group">
          <label class="form-label">Or Paste JSON Data</label>
          <textarea class="form-textarea" id="bulkJson"
            placeholder='[{"voucherType":"Journal","date":"20260115","companyName":"ABC Ltd","narration":"Test","ledgerEntries":[...]}]'></textarea>
        </div>

        <button class="btn btn-primary" onclick="processBulkVouchers()" style="width: 100%;">
          Process Bulk Vouchers
        </button>

        <div id="bulkResults" style="margin-top: 1.5rem;"></div>
      </div>
    </div>

    <!-- Tab Content: View Data -->
    <div id="viewTab" class="tab-content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Companies</h2>
        </div>
        <button class="btn btn-secondary" onclick="loadCompanies()" style="width: 100%;">
          Load Companies
        </button>
        <div id="companiesList" style="margin-top: 1rem;"></div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Ledgers</h2>
        </div>
        <div class="form-group">
          <input type="text" class="form-input" id="viewLedgerCompany" placeholder="Enter company name">
        </div>
        <button class="btn btn-secondary" onclick="loadLedgers()" style="width: 100%;">
          Load Ledgers
        </button>
        <div id="ledgersList" style="margin-top: 1rem;"></div>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>

</html>